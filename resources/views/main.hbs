<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Board</title>
    <style>
      html{
        height: 100% !important;
      }
      body{
        height: 100%;
      }
      .container-fluid{
        height: 100%;
      }
      canvas {
        border: 1px solid red;
      }
      .canvas-container{
        width: 100% !important;
        height: 100% !important;
      }
      .lower-canvas{
        width: 100% !important;
        height: 100% !important;
      }
      .upper-canvas{
        width: 100% !important;
        height: 100% !important;
      }
    </style>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js" integrity="sha512-csNcFYJniKjJxRWRV1R7fvnXrycHP6qDR21mgz1ZP55xY5d+aHLfo9/FcGDQLfn2IfngbAHd8LdfsagcCqgTcQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script
      src="https://code.jquery.com/jquery-3.6.0.slim.js"
      integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/460/fabric.min.js"
      integrity="sha512-ybPp3kCrNQXdvTfh99YLIdnajWnQvHuEKDJ+b26mxI9w+pLhnBo3HmNLJ1pEUBFO1Q0bfJxApeqecNbmaV763g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script type="text/javascript" src="js/functions.js"></script>
  </head>
  <body>
    <div class="d-flex flex-wrap" style="margin: 0 0 0 5px">
      <div style="margin-top: 10px">
        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Start sketch"
        >
          <i class="fa fa-pencil"></i>
          <!-- Start sketch -->
        </button>
        <button
          type="button"
          class="btn btn-outline-success"
          id="disable_pen"
          data-bs-toggle="tooltip"
          title="Start selection"
        >
          <i class="fa fa-mouse-pointer"></i>
          <!-- Start Selection -->
        </button>
        <button
          type="button"
          class="btn btn-outline-success"
          id="addcircle"
          data-bs-toggle="tooltip"
          title="Add circle"
        >
          <i class="fa fa-circle-thin"></i>
          <!-- Add Circle -->
        </button>
        <button
          type="button"
          class="btn btn-outline-success"
          id="addsquare"
          data-bs-toggle="tooltip"
          title="Add square"
        >
          <i class="fa fa-square-o"></i>
          <!-- Add Square -->
        </button>
        <button
          type="button"
          class="btn btn-outline-success"
          id="addtriangle"
          data-bs-toggle="tooltip"
          title="Add triangle"
        >
          <div style="font-size: 0.5rem">
            <i class="fa fa-caret-up fa-3x"></i>
          </div>
          <!-- Add Triangle -->
        </button>
      </div>

      <div class="d-flex" style="margin-left: 10px; margin-top: 10px">
        <input
          type="color"
          id="fill_color"
          name="fill_color"
          value="#ff0000"
          style="height: 38px"
        />
        <div class="input-group-prepend">
          <!-- <span class="input-group-text" id="basic-addon1">Fill</span> -->
          <span
            style="background-color: white"
            class="input-group-text"
            id="basic-addon1"
            data-bs-toggle="tooltip"
            title="Fill color"
            ><img
              src="/static/fill.png"
              alt="fill"
              style="height: 24px; width: 24px"
          /></span>
        </div>
      </div>

      <!-- <button type="button" class="btn btn-outline-success" id="fillcolor">
        Fill
      </button> -->

      <div class="d-flex" style="margin-left: 10px; margin-top: 10px">
        <input
          type="color"
          id="border_color"
          name="border_color"
          value="#ff0000"
          style="height: 38px"
        />
        <div class="input-group-prepend">
          <span
            style="background-color: white"
            class="input-group-text"
            id="basic-addon1"
            data-bs-toggle="tooltip"
            title="Border"
            ><img
              src="/static/border.png"
              alt="border"
              style="height: 24px; width: 24px"
          /></span>
          <!-- <span class="input-group-text" id="basic-addon1">Border</span> -->
        </div>
      </div>
      <!-- <button type="button" class="btn btn-outline-success" id="bordercolor">
        Border
      </button> -->

      <div class="d-flex" style="margin-left: 10px; margin-top: 10px">
        <input
          type="color"
          id="favcolor"
          name="favcolor"
          value="#ff0000"
          style="height: 38px"
        />
        <div class="input-group-prepend">
          <span
            style="background-color: white"
            class="input-group-text"
            id="basic-addon1"
            data-bs-toggle="tooltip"
            title="Change color"
            ><img
              src="/static/colours.png"
              alt="colors"
              style="height: 24px; width: 24px"
          /></span>
          <!-- <span class="input-group-text" id="basic-addon1">Change Color</span> -->
        </div>
      </div>
      <!-- <button type="button" class="btn btn-outline-success" id="changecolor">
        Change color
      </button> -->

      <div class="d-flex" style="margin-left: 10px; margin-top: 10px">
        <input
          type="range"
          id="widthstorek"
          name="widthstorek"
          min="1"
          max="300"
        />
        <div class="input-group-prepend">
          <span
            style="background-color: white"
            class="input-group-text"
            id="basic-addon1"
            data-bs-toggle="tooltip"
            title="Change color"
            ><img
              src="/static/width.png"
              alt="fill"
              style="height: 24px; width: 24px"
          /></span>
          <!-- <span class="input-group-text" id="basic-addon1">Change Width</span> -->
        </div>
      </div>

      <div class="d-flex" style="margin-left: 10px; margin-top: 10px">
        <button
          type="button"
          class="btn btn-outline-success"
          id="addtext"
          data-bs-toggle="tooltip"
          title="Add text"
        >
          <i class="fa fa-font"></i>
        </button>
        <input type="file" id="selectedimage" class="form-control" style="margin-left: 10px;"></input>
      </div>

      <!-- <button type="button" class="btn btn-outline-success" id="changewidth">
        Change width
      </button> -->
    </div>

    <div class="d-flex flex-wrap" style="margin: 10px 0 10px 5px">
      <select
        class="form-select"
        aria-label="Default select example"
        style="width: 200px"
        id="font_family"
        onclick="fontFamily()"
      >
        <option selected value="">Font family</option>
        <option value="1">One</option>
        <option value="2">Two</option>
        <option value="3">Three</option>
      </select>

      <select
        class="form-select"
        aria-label="Default select example"
        style="width: 150px; margin-left: 10px"
        id="font_size"
        onclick="fontSize()"
      >
        <option selected>Font size</option>
        <option value="1">One</option>
        <option value="2">Two</option>
        <option value="3">Three</option>
      </select>

      <div style="margin-left: 10px">
        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Bold"
          onclick="bold()"
        >
          <i class="fa fa-bold"></i>
        </button>

        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Italic"
          onclick="italic()"
        >
          <i class="fa fa-italic"></i>
        </button>

        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Underline"
          onclick="underline()"
        >
          <i class="fa fa-underline"></i>
        </button>

        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Strikethrough"
          onclick="strikethrough()"
        >
          <i class="fa fa-strikethrough"></i>
        </button>
      </div>

      <div style="margin-left: 10px">
        <!-- Paragraph alignment -->
        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Align left"
          onclick="align_left()"
        >
          <i class="fa fa-align-left"></i>
        </button>

        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Align center"
          onclick="align_center()"
        >
          <i class="fa fa-align-center"></i>
        </button>

        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Align right"
          onclick="align_right()"
        >
          <i class="fa fa-align-right"></i>
        </button>

        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Justify alignment"
          onclick="align_justify()"
        >
          <i class="fa fa-align-justify"></i>
        </button>
      </div>

      <div style="margin-left: 10px">
        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Order list"
          onclick="order_list()"
        >
          <i class="fa fa-list-ol"></i>
        </button>

        <button
          type="button"
          class="btn btn-outline-success"
          id="enable_pen"
          data-bs-toggle="tooltip"
          title="Unorder list"
          onclick="unorder_list()"
        >
          <i class="fa fa-list-ul"></i>
        </button>
        <button id="save">Save</button>
      </div>
    </div>

    <div class="container-fluid" style="margin-left: -5px">
      <canvas id="canvasId"></canvas>
    </div>
  </body>

  <script>



      function getBase64(file) {
        return new Promise((resolve, reject)=>{
            var reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
              resolve(reader.result);
            };
            reader.onerror = function (error) {
              console.log('Error: ', error);
              reject(error)
            };
        })
    }

    var canvas = new fabric.Canvas(document.getElementById("canvasId"));
    function convertToImagen() {
      var svg = canvas.toSVG();
console.log(svg)
    }
    canvas.setBackgroundImage("https://www.airforshare.com/files/HBtnDD.jpeg", canvas.renderAll.bind(canvas), {
    // Optionally add an opacity lvl to the image
    backgroundImageOpacity: 0.5,
    // should the image be resized to fit the container?
    scaleX: 5,
            scaleY:5
});
    $("#disable_pen").click((e) => {
      canvas.isDrawingMode = false;
    });
    $("#save").click((e)=>{
  convertToImagen()
})

    $("#enable_pen").click((e) => {
      canvas.isDrawingMode = true;
      canvas.freeDrawingBrush.width =
        document.getElementById("widthstorek").value;
      canvas.freeDrawingBrush.color = document.getElementById("favcolor").value;
    });

    $("#favcolor").change((e) => {
      let c = document.getElementById("favcolor").value;
      canvas.freeDrawingBrush.color = c;
    });
    $("#widthstorek").change((e) => {
      //   console.log(e, "WWWWWWWWWWWWWWWWWWWWWWWWWWW");
      let c = document.getElementById("widthstorek").value;
      canvas.freeDrawingBrush.width = c;
    });

    $("#addcircle").click((e) => {
      var circle = new fabric.Circle({
        radius: 20,
        fill: "white",
        stroke: "black",
        left: 100,
        top: 100,
      });
      canvas.add(circle);
    });

    $("#addsquare").click((e) => {
      var square = new fabric.Polygon(
        [
          { x: 10, y: 10 },
          { x: 40, y: 10 },
          { x: 10, y: 40 },
          { x: 40, y: 40 },
        ],
        {
          fill: "white",
          stroke: "black",
          left: 50,
          top: 50,
        }
      );
      canvas.add(square);
    });
    $("#addtriangle").click((e) => {
      var triangle = new fabric.Triangle({
        width: 20,
        height: 30,
        fill: "white",
        stroke: "black",
        left: 50,
        top: 50,
      });
      canvas.add(triangle);
    });

    $("#border_color").change((e) => {
      canvas
        .getActiveObject()
        .set("stroke", document.getElementById("border_color").value);
      canvas.renderAll();
    });
    $("#fill_color").change((e) => {
      //   console.log(e, "EEdEEEEEEEEEEEEEEEEEEEEEEEEEEEE");
      canvas
        .getActiveObject()
        .set("fill", document.getElementById("fill_color").value);
      canvas.renderAll();
    });

    canvas.on("path:created", function (e) {
      e.path.set();
      canvas.renderAll();
      // console.log(canvas.toDataURL("image/png").replace("img/png", "image/octet-string"));
    });

$("#selectedimage").change((e)=>{
  let s = document.getElementById("selectedimage").files[0]
  getBase64(s).then((result)=>{
    let last_image = document.createElement("img")
    last_image.src = result
        var imgInstance = new fabric.Image(last_image, {
            left: 100,
            top: 100,
            angle: 1,
            opacity: 0.99
        });
        console.log(imgInstance)
        setTimeout(() => {
          canvas.add(imgInstance)
          document.getElementById("selectedimage").value=""
        }, 2000);
    
       
  }).catch((e)=>{
    console.log(e,"dfdfdfdfdfdfdf")
  })
 
})

$("#addtext").click((e)=>{
    //alert("dfdfdf")
    var text = new fabric.IText('Text', { left: 100, top: 100 });
    canvas.add(text);
})
canvas.on('text:editing:entered', (textObject) => {
    console.log("sdsdsdsd")
  // calculate canvas offset and textObject offset and scroll to this position
})
canvas.on('mouse:down', function(options) {
  if (options.target) {
    console.log('an object was clicked! ', options.target.type);
  }
});

  </script>
</html>
